<?xml version="1.0" encoding="UTF-8" ?>
<project name="maven-antrun-" default="main"  >
<target name="main">
  <taskdef resource="net/sf/antcontrib/antlib.xml"/>
  <exec resultproperty="gitExitCode.lastCommit" failifexecutionfails="false" failonerror="false" outputproperty="gitOutput.lastCommit" executable="git">
    <arg value="log"/>
    <arg value="-1"/>
    <arg value="--format=format:%h %H %cd"/>
    <arg value="--date=iso"/>
  </exec>
  <propertyregex input="${gitOutput.lastCommit}" regexp="^([0-9a-f]+) .*$" select="\1" defaultValue="0" property="shortCommitHash" casesensitive="true"/>
  <propertyregex input="${gitOutput.lastCommit}" regexp="^[0-9a-f]+ ([0-9a-f]{40}) .*$" select="\1" defaultValue="0000000000000000000000000000000000000000" property="longCommitHash" casesensitive="true"/>
  <propertyregex input="${gitOutput.lastCommit}" regexp="^[0-9a-f]+ [0-9a-f]{40} (.*)$" select="\1" defaultValue="1970-01-01 00:00:00 +0000" property="commitDate" casesensitive="true"/>
  <exec resultproperty="gitExitCode.repoStatus" failifexecutionfails="false" failonerror="false" outputproperty="gitOutput.repoStatus" executable="git">
    <arg value="status"/>
    <arg value="--porcelain"/>
  </exec>
  <if>
    <equals arg2="0" arg1="${gitExitCode.repoStatus}"/>
    <then>
      <if>
        <equals arg2="" arg1="${gitOutput.repoStatus}"/>
        <then>
          <property name="repoStatus" value="clean"/>
        </then>
        <else>
          <property name="repoStatus" value="dirty"/>
        </else>
      </if>
    </then>
    <else>
      <property name="repoStatus" value="unknown"/>
    </else>
  </if>
  <echo>Current commit: ${shortCommitHash} on ${commitDate}</echo>
  <property name="metaInfDir" value="/Users/oovever/Documents/projcet/Github/netty/codec-mqtt/target/classes/META-INF"/>
  <property name="versionPropFile" value="${metaInfDir}/io.netty.versions.properties"/>
  <mkdir dir="${metaInfDir}"/>
  <delete file="${versionPropFile}" quiet="true"/>
  <propertyfile file="${versionPropFile}" comment="Generated by netty-parent/pom.xml">
    <entry value="4.1.80.Final-SNAPSHOT" key="netty-codec-mqtt.version"/>
    <entry pattern="yyyy-MM-dd HH:mm:ss Z" type="date" value="now" key="netty-codec-mqtt.buildDate"/>
    <entry value="${commitDate}" key="netty-codec-mqtt.commitDate"/>
    <entry value="${shortCommitHash}" key="netty-codec-mqtt.shortCommitHash"/>
    <entry value="${longCommitHash}" key="netty-codec-mqtt.longCommitHash"/>
    <entry value="${repoStatus}" key="netty-codec-mqtt.repoStatus"/>
  </propertyfile>
</target>
</project>